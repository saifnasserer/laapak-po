generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}


model Client {
  id          String   @id @default(uuid())
  name        String
  phone       String?
  taxRegistrationNumber String? @unique
  contactInfo String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  pos         PurchaseOffer[]
  etaInvoices ETAInvoice[]
}

model PurchaseOffer {
  id                String   @id @default(uuid())
  publicId          String   @unique
  status            String   @default("DRAFT") // DRAFT, PUBLISHED, EXPIRED
  clientId          String
  client            Client   @relation(fields: [clientId], references: [id], onDelete: Cascade)
  validUntil        DateTime?
  currency          String   @default("EGP")
  taxRate           Float    @default(0)
  discount          Float    @default(0)
  paymentTerms      String?  @db.Text
  warranty          String?  @db.Text
  termsAndConditions String? @db.Text
  showProductOverview Boolean @default(true)
  showWarranty      Boolean  @default(true)
  showPricingSummary Boolean  @default(true)
  showWhyLaapak      Boolean  @default(true)
  showPaymentTerms   Boolean  @default(true)
  showTermsAndConditions Boolean @default(true)
  showApproval       Boolean  @default(true)
  items             LineItem[]
  views             POView[]
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
}

model LineItem {
  id                String   @id @default(uuid())
  poId              String
  po                PurchaseOffer @relation(fields: [poId], references: [id], onDelete: Cascade)
  model             String
  quantity          Int
  price             Float
  specs             String?  @db.Text
  qcProcess         String?  @db.Text
  notes             String?  @db.Text
  deliveryTime      String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
}

model POView {
  id          String   @id @default(uuid())
  poId        String
  po          PurchaseOffer @relation(fields: [poId], references: [id], onDelete: Cascade)
  viewedAt    DateTime @default(now())
  userAgent   String?
}

model ETAInvoice {
  uuid                String   @id
  submissionUUID      String?
  longId              String?
  internalId          String
  documentType        String   @default("I") // I=Invoice, C=Credit, D=Debit
  dateTimeIssued      DateTime
  taxpayerActivityCode String?
  receiverId          String
  receiverName        String
  issuerId            String
  issuerName          String
  totalSalesAmount    Float    @default(0)
  totalDiscountAmount Float    @default(0)
  netAmount           Float    @default(0)
  totalTax            Float    @default(0)
  totalAmount         Float    @default(0)
  status              String   @default("Valid")
  fullDocument        Json?
  
  client              Client?  @relation(fields: [receiverId], references: [taxRegistrationNumber])

  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  @@index([receiverId])
  @@index([issuerId])
  @@index([dateTimeIssued])
}
